<!-- Audit Tab -->
<div id="tab-audit" class="tab-content">
    <header class="tab-header">
        <h1>ğŸ”¬ Audit</h1>
        <div style="display:flex;align-items:center;gap:var(--space-md)">
            <button class="btn btn-sm btn-ghost" onclick="openSavedAuditBrowser('project')" title="Browse saved Project audits">
                ğŸ“ Saved
            </button>
            <span class="pending-audits-badge" id="pending-project-audits-badge" style="display:none" onclick="openAuditManager(null,'project')" title="Unsaved project audit snapshots â€” click to manage"></span>
            <button class="btn btn-sm btn-secondary" onclick="loadAuditTab(true)" title="Force-refresh all audit cards">
                ğŸ”„ Refresh All
            </button>
        </div>
    </header>

    <!-- â”€â”€ Master Scores Banner â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div id="audit-scores-banner" class="card" style="margin-bottom:var(--space-lg)">
        <div class="card-header">
            <span class="card-title">ğŸ“Š Master Scores</span>
            <div style="display:flex;align-items:center;gap:0.4rem">
                <span class="card-age" data-cache-key="audit:scores" style="font-size:0.64rem;color:var(--text-muted)"></span>
                <button class="btn btn-sm btn-ghost" onclick="loadAuditScoresEnriched()" id="audit-enrich-btn" title="Enrich scores with full L2 analysis (takes 5-25s)" style="font-size:0.68rem;padding:2px 8px">
                    ğŸ”¬ Enrich
                </button>
                <span class="status-badge" id="audit-scores-badge">â€”</span>
                <span class="audit-pending-badge" data-audit-key="audit:scores" onclick="openAuditManager(this.dataset.auditKey)" title="Unsaved audit â€” click to manage" style="display:none">ğŸ“‹</span>
            </div>
        </div>
        <div id="audit-scores-detail" style="margin-top:var(--space-md)">
            <span class="spinner"></span>
        </div>
    </div>

    <div class="card-grid">

        <!-- â”€â”€ System Profile Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <div class="card" id="audit-system-card">
            <div class="card-header">
                <span class="card-title">ğŸ–¥ï¸ System Profile</span>
                <div style="display:flex;align-items:center;gap:0.4rem">
                    <span class="card-age" data-cache-key="audit:system" style="font-size:0.64rem;color:var(--text-muted)"></span>
                    <button class="btn-icon" onclick="cardRefresh('audit:system','audit-system-badge','audit-system-detail',loadAuditSystemCard)" title="Re-detect system profile" style="font-size:0.7rem;cursor:pointer;background:none;border:none;color:var(--text-muted);padding:0">ğŸ”„</button>
                    <span class="status-badge" id="audit-system-badge">â€”</span>
                    <span class="audit-pending-badge" data-audit-key="audit:system" onclick="openAuditManager(this.dataset.auditKey)" title="Unsaved audit â€” click to manage" style="display:none">ğŸ“‹</span>
                </div>
            </div>
            <div class="card-subtitle">OS, Python, Node, available tools, virtual environment, project modules</div>
            <div id="audit-system-detail" class="integration-detail" style="margin-top:var(--space-md)">
                <span class="spinner"></span>
            </div>
        </div>

        <!-- â”€â”€ Dependencies & Libraries Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <div class="card" id="audit-deps-card">
            <div class="card-header">
                <span class="card-title">ğŸ“¦ Dependencies & Libraries</span>
                <div style="display:flex;align-items:center;gap:0.4rem">
                    <span class="card-age" data-cache-key="audit:deps" style="font-size:0.64rem;color:var(--text-muted)"></span>
                    <button class="btn-icon" onclick="cardRefresh('audit:deps','audit-deps-badge','audit-deps-detail',loadAuditDepsCard)" title="Re-parse manifests" style="font-size:0.7rem;cursor:pointer;background:none;border:none;color:var(--text-muted);padding:0">ğŸ”„</button>
                    <span class="status-badge" id="audit-deps-badge">â€”</span>
                    <span class="audit-pending-badge" data-audit-key="audit:deps" onclick="openAuditManager(this.dataset.auditKey)" title="Unsaved audit â€” click to manage" style="display:none">ğŸ“‹</span>
                </div>
            </div>
            <div class="card-subtitle">Library inventory, framework/ORM/client identification, cross-ecosystem crossovers</div>
            <div id="audit-deps-detail" class="integration-detail" style="margin-top:var(--space-md)">
                <span class="spinner"></span>
            </div>
        </div>

        <!-- â”€â”€ Structure & Modules Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <div class="card" id="audit-structure-card">
            <div class="card-header">
                <span class="card-title">ğŸ—ï¸ Structure & Modules</span>
                <div style="display:flex;align-items:center;gap:0.4rem">
                    <span class="card-age" data-cache-key="audit:structure" style="font-size:0.64rem;color:var(--text-muted)"></span>
                    <button class="btn-icon" onclick="cardRefresh('audit:structure','audit-structure-badge','audit-structure-detail',loadAuditStructureCard)" title="Re-detect structure" style="font-size:0.7rem;cursor:pointer;background:none;border:none;color:var(--text-muted);padding:0">ğŸ”„</button>
                    <span class="status-badge" id="audit-structure-badge">â€”</span>
                    <span class="audit-pending-badge" data-audit-key="audit:structure" onclick="openAuditManager(this.dataset.auditKey)" title="Unsaved audit â€” click to manage" style="display:none">ğŸ“‹</span>
                </div>
            </div>
            <div class="card-subtitle">Solution classification, components, entrypoints, infrastructure flags</div>
            <div id="audit-structure-detail" class="integration-detail" style="margin-top:var(--space-md)">
                <span class="spinner"></span>
            </div>
        </div>

        <!-- â”€â”€ Clients & Services Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <div class="card" id="audit-clients-card">
            <div class="card-header">
                <span class="card-title">ğŸ”Œ Clients & Services</span>
                <div style="display:flex;align-items:center;gap:0.4rem">
                    <span class="card-age" data-cache-key="audit:clients" style="font-size:0.64rem;color:var(--text-muted)"></span>
                    <button class="btn-icon" onclick="cardRefresh('audit:clients','audit-clients-badge','audit-clients-detail',loadAuditClientsCard)" title="Re-detect clients" style="font-size:0.7rem;cursor:pointer;background:none;border:none;color:var(--text-muted);padding:0">ğŸ”„</button>
                    <span class="status-badge" id="audit-clients-badge">â€”</span>
                    <span class="audit-pending-badge" data-audit-key="audit:clients" onclick="openAuditManager(this.dataset.auditKey)" title="Unsaved audit â€” click to manage" style="display:none">ğŸ“‹</span>
                </div>
            </div>
            <div class="card-subtitle">External service clients (databases, caches, message brokers, cloud SDKs)</div>
            <div id="audit-clients-detail" class="integration-detail" style="margin-top:var(--space-md)">
                <span class="spinner"></span>
            </div>
        </div>

    </div>

    <!-- â”€â”€ L2 On-Demand Section â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div style="margin-top:var(--space-xl)">
        <div style="display:flex;align-items:center;gap:var(--space-sm);margin-bottom:var(--space-md)">
            <h2 style="margin:0;font-size:1.1rem">ğŸ”¬ Deep Analysis</h2>
            <span style="font-size:0.72rem;color:var(--text-muted);padding:2px 8px;border-radius:var(--radius-sm);background:var(--bg-secondary)">L2 Â· on-demand</span>
        </div>
        <p style="color:var(--text-muted);font-size:0.78rem;margin-bottom:var(--space-lg)">
            These cards perform heavier analysis (AST parsing, git inspection, cross-service checks).
            Click <strong>â–¶ Analyze</strong> to run â€” results are cached after first run.
        </p>

        <div class="card-grid">

            <!-- â”€â”€ Code Health Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
            <div class="card" id="audit-health-card">
                <div class="card-header">
                    <span class="card-title">ğŸ“Š Code Health</span>
                    <div style="display:flex;align-items:center;gap:0.4rem">
                        <span class="card-age" data-cache-key="audit:l2:quality" style="font-size:0.64rem;color:var(--text-muted)"></span>
                        <button class="btn btn-ghost btn-sm" onclick="cardRefresh('audit:l2:quality','audit-health-badge','audit-health-detail',loadAuditHealthCard)" title="Refresh code health" style="padding:2px 6px;font-size:0.72rem">ğŸ”„</button>
                        <span class="status-badge" id="audit-health-badge">â€”</span>
                        <span class="audit-pending-badge" data-audit-key="audit:l2:quality" onclick="openAuditManager(this.dataset.auditKey)" title="Unsaved audit â€” click to manage" style="display:none">ğŸ“‹</span>
                    </div>
                </div>
                <div class="card-subtitle">AST-based quality metrics â€” docstring coverage, function length, nesting depth, naming consistency</div>
                <div id="audit-health-detail" class="integration-detail" style="margin-top:var(--space-md)">
                    <div style="text-align:center;padding:var(--space-lg)">
                        <button class="btn btn-sm btn-primary" onclick="loadAuditHealthCard()" id="audit-health-trigger">
                            â–¶ Analyze Code Health
                        </button>
                        <div style="font-size:0.7rem;color:var(--text-muted);margin-top:6px">~2s Â· parses all Python files via AST</div>
                    </div>
                </div>
            </div>

            <!-- â”€â”€ Repo Health Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
            <div class="card" id="audit-repo-card">
                <div class="card-header">
                    <span class="card-title">ğŸ“‚ Repo Health</span>
                    <div style="display:flex;align-items:center;gap:0.4rem">
                        <span class="card-age" data-cache-key="audit:l2:repo" style="font-size:0.64rem;color:var(--text-muted)"></span>
                        <button class="btn btn-ghost btn-sm" onclick="cardRefresh('audit:l2:repo','audit-repo-badge','audit-repo-detail',loadAuditRepoCard)" title="Refresh repo health" style="padding:2px 6px;font-size:0.72rem">ğŸ”„</button>
                        <span class="status-badge" id="audit-repo-badge">â€”</span>
                        <span class="audit-pending-badge" data-audit-key="audit:l2:repo" onclick="openAuditManager(this.dataset.auditKey)" title="Unsaved audit â€” click to manage" style="display:none">ğŸ“‹</span>
                    </div>
                </div>
                <div class="card-subtitle">Git history depth, object database size, large files, binary tracking, branch and tag hygiene</div>
                <div id="audit-repo-detail" class="integration-detail" style="margin-top:var(--space-md)">
                    <div style="text-align:center;padding:var(--space-lg)">
                        <button class="btn btn-sm btn-primary" onclick="loadAuditRepoCard()" id="audit-repo-trigger">
                            â–¶ Analyze Repository
                        </button>
                        <div style="font-size:0.7rem;color:var(--text-muted);margin-top:6px">~3s Â· inspects git objects and file tree</div>
                    </div>
                </div>
            </div>

            <!-- â”€â”€ Risks & Issues Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
            <div class="card" id="audit-risks-card">
                <div class="card-header">
                    <span class="card-title">âš ï¸ Risks & Issues</span>
                    <div style="display:flex;align-items:center;gap:0.4rem">
                        <span class="card-age" data-cache-key="audit:l2:risks" style="font-size:0.64rem;color:var(--text-muted)"></span>
                        <button class="btn btn-ghost btn-sm" onclick="cardRefresh('audit:l2:risks','audit-risks-badge','audit-risks-detail',loadAuditRisksCard)" title="Refresh risks scan" style="padding:2px 6px;font-size:0.72rem">ğŸ”„</button>
                        <span class="status-badge" id="audit-risks-badge">â€”</span>
                        <span class="audit-pending-badge" data-audit-key="audit:l2:risks" onclick="openAuditManager(this.dataset.auditKey)" title="Unsaved audit â€” click to manage" style="display:none">ğŸ“‹</span>
                    </div>
                </div>
                <div class="card-subtitle">Cross-service risk aggregation â€” security findings, dependency vulnerabilities, documentation gaps, test coverage</div>
                <div id="audit-risks-detail" class="integration-detail" style="margin-top:var(--space-md)">
                    <div style="text-align:center;padding:var(--space-lg)">
                        <button class="btn btn-sm btn-primary" onclick="loadAuditRisksCard()" id="audit-risks-trigger">
                            â–¶ Scan for Risks
                        </button>
                        <div style="font-size:0.7rem;color:var(--text-muted);margin-top:6px">~8-20s Â· invokes security, package, docs, and testing ops</div>
                    </div>
                </div>
            </div>

            <!-- â”€â”€ Structure Analysis Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
            <div class="card" id="audit-l2structure-card">
                <div class="card-header">
                    <span class="card-title">ğŸ”— Import Graph & Coupling</span>
                    <div style="display:flex;align-items:center;gap:0.4rem">
                        <span class="card-age" data-cache-key="audit:l2:structure" style="font-size:0.64rem;color:var(--text-muted)"></span>
                        <button class="btn btn-ghost btn-sm" onclick="cardRefresh('audit:l2:structure','audit-l2structure-badge','audit-l2structure-detail',loadAuditL2StructureCard)" title="Refresh structure analysis" style="padding:2px 6px;font-size:0.72rem">ğŸ”„</button>
                        <span class="status-badge" id="audit-l2structure-badge">â€”</span>
                        <span class="audit-pending-badge" data-audit-key="audit:l2:structure" onclick="openAuditManager(this.dataset.auditKey)" title="Unsaved audit â€” click to manage" style="display:none">ğŸ“‹</span>
                    </div>
                </div>
                <div class="card-subtitle">Import graph, module boundaries, exposure ratios, cross-module dependency mapping with strength classification</div>
                <div id="audit-l2structure-detail" class="integration-detail" style="margin-top:var(--space-md)">
                    <div style="text-align:center;padding:var(--space-lg)">
                        <button class="btn btn-sm btn-primary" onclick="loadAuditL2StructureCard()" id="audit-l2structure-trigger">
                            â–¶ Analyze Imports
                        </button>
                        <div style="font-size:0.7rem;color:var(--text-muted);margin-top:6px">~2s Â· full AST import graph</div>
                    </div>
                </div>
            </div>

        </div>
    </div>

</div>
