<script>
    // ── Tab switching ───────────────────────────────────────────────────

    let activeTab = 'dashboard';

    function switchTab(tabId) {
        // Parse compound tab IDs like 'wizard/modules' or 'content/media/docs'
        let subStep = null;
        let subParts = [];
        if (tabId.includes('/')) {
            const parts = tabId.split('/');
            tabId = parts[0];
            subStep = parts[1];
            subParts = parts.slice(1);
        }

        // Update button active states
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));

        const tabBtn = document.querySelector(`[onclick="switchTab('${tabId}')"]`);
        if (tabBtn) tabBtn.classList.add('active');
        const tabEl = document.getElementById(`tab-${tabId}`);
        if (tabEl) tabEl.classList.add('active');

        // Update URL hash (keep full compound ID)
        const hashParts = [tabId, ...subParts];
        history.replaceState(null, '', `#${hashParts.join('/')}`);

        activeTab = tabId;

        // Load data for the tab
        if (tabId === 'dashboard') {
            loadStatus();
        } else if (tabId === 'commands') {
            if (!capabilitiesLoaded) loadCapabilities();
        } else if (tabId === 'wizard') {
            if (subStep) {
                const stepIdx = wizardSteps.findIndex(s => s.id === subStep);
                if (stepIdx !== -1) currentWizardStep = stepIdx;
            }
            renderWizard();
        } else if (tabId === 'secrets') {
            if (subStep) {
                selectedEnv = subStep;
                secretsLoaded = false;
            }
            loadSecretsTab();
        } else if (tabId === 'debugging') {
            loadDebugTab();
        } else if (tabId === 'integrations') {
            loadIntegrationsTab();
        } else if (tabId === 'content') {
            loadContentTab(subParts);
        }
    }

    // Restore tab from URL hash on page load
    function restoreFromHash() {
        const hash = location.hash.slice(1);
        if (hash) {
            switchTab(hash);
        }
    }

    // Handle back/forward navigation
    window.addEventListener('hashchange', () => {
        const hash = location.hash.slice(1);
        if (hash && hash !== activeTab) {
            switchTab(hash);
        }
    });
</script>