    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    //  _secrets_vault.html
    //  Vault lock/unlock modals (showVaultLockModal, showVaultUnlockModal, vaultDoLock, vaultDoUnlock)
    //  Included by: _secrets.html (Jinja2 include)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€




    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  Vault lock/unlock modals
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    function showVaultLockModal() {
        const envFile = _envFile();
        const modal = document.createElement('div');
        modal.className = 'vault-modal-overlay';
        modal.id = 'vault-modal';
        modal.innerHTML = `
        <div class="vault-modal">
            <h2 style="margin-bottom:var(--space-md)">ğŸ”’ Lock Vault</h2>
            <p style="color:var(--text-secondary);margin-bottom:var(--space-sm);font-size:0.88rem;line-height:1.5">
                Your <code>${esc(envFile)}</code> will be encrypted with AES-256-GCM and the plaintext securely deleted.
            </p>
            <p style="color:var(--warning);margin-bottom:var(--space-lg);font-size:0.82rem;line-height:1.4;font-weight:600">
                âš ï¸ Your passphrase is the ONLY way to recover your secrets. If you lose it, your data is gone.
            </p>
            <div class="form-group" style="margin-bottom:var(--space-md)">
                <label for="vault-passphrase">Passphrase (min 4 characters)</label>
                <input type="password" id="vault-passphrase" placeholder="Enter passphraseâ€¦"
                    autocomplete="off">
            </div>
            <div class="form-group" style="margin-bottom:var(--space-md)">
                <label for="vault-passphrase-confirm">Confirm passphrase</label>
                <input type="password" id="vault-passphrase-confirm" placeholder="Re-enter passphraseâ€¦"
                    autocomplete="off" onkeydown="if(event.key==='Enter') vaultDoLock()">
            </div>
            <div id="vault-modal-error" style="color:var(--error);font-size:0.82rem;margin-bottom:var(--space-sm);display:none"></div>
            <div style="display:flex;gap:var(--space-sm);justify-content:flex-end">
                <button class="btn btn-secondary" onclick="closeVaultModal()">Cancel</button>
                <button class="btn btn-primary" id="vault-modal-btn" onclick="vaultDoLock()">ğŸ”’ Lock</button>
            </div>
        </div>`;
        document.body.appendChild(modal);
        document.getElementById('vault-passphrase').focus();
    }

    function showVaultUnlockModal() {
        const envFile = _envFile();
        const vaultFile = `${envFile}.vault`;
        const modal = document.createElement('div');
        modal.className = 'vault-modal-overlay';
        modal.id = 'vault-modal';
        modal.innerHTML = `
        <div class="vault-modal">
            <h2 style="margin-bottom:var(--space-md)">ğŸ”“ Unlock Vault</h2>
            <p style="color:var(--text-secondary);margin-bottom:var(--space-lg);font-size:0.88rem;line-height:1.5">
                Decrypt your <code>${esc(vaultFile)}</code> back to <code>${esc(envFile)}</code>. Auto-lock will re-encrypt after inactivity.
            </p>
            <div class="form-group" style="margin-bottom:var(--space-md)">
                <label for="vault-passphrase">Passphrase</label>
                <input type="password" id="vault-passphrase" placeholder="Enter passphraseâ€¦"
                    autocomplete="off" onkeydown="if(event.key==='Enter') vaultDoUnlock()">
            </div>
            <div id="vault-modal-error" style="color:var(--error);font-size:0.82rem;margin-bottom:var(--space-sm);display:none"></div>
            <div style="display:flex;gap:var(--space-sm);justify-content:flex-end">
                <button class="btn btn-secondary" onclick="closeVaultModal()">Cancel</button>
                <button class="btn btn-primary" id="vault-modal-btn" onclick="vaultDoUnlock()">ğŸ”“ Unlock</button>
            </div>
        </div>`;
        document.body.appendChild(modal);
        document.getElementById('vault-passphrase').focus();
    }

    function closeVaultModal() {
        const modal = document.getElementById('vault-modal');
        if (modal) modal.remove();
    }

    async function vaultDoLock() {
        const passphrase = document.getElementById('vault-passphrase').value;
        const confirm_pass = document.getElementById('vault-passphrase-confirm').value;
        const errEl = document.getElementById('vault-modal-error');
        const btn = document.getElementById('vault-modal-btn');

        if (!passphrase || passphrase.length < 4) {
            errEl.textContent = 'Passphrase must be at least 4 characters';
            errEl.style.display = 'block';
            return;
        }

        if (passphrase !== confirm_pass) {
            errEl.textContent = 'Passphrases do not match â€” please re-enter';
            errEl.style.display = 'block';
            document.getElementById('vault-passphrase-confirm').value = '';
            document.getElementById('vault-passphrase-confirm').focus();
            return;
        }

        btn.disabled = true;
        btn.innerHTML = '<span class="spinner"></span> Lockingâ€¦';

        try {
            await api(`/vault/lock${_envQS()}`, { method: 'POST', body: JSON.stringify({ passphrase }) });
            closeVaultModal();
            toast('Vault locked â€” secrets encrypted', 'success');
            await loadSecretsTab();
        } catch (e) {
            errEl.textContent = e.message;
            errEl.style.display = 'block';
        } finally {
            btn.disabled = false;
            btn.textContent = 'ğŸ”’ Lock';
        }
    }

    async function vaultDoUnlock() {
        const passphrase = document.getElementById('vault-passphrase').value;
        const errEl = document.getElementById('vault-modal-error');
        const btn = document.getElementById('vault-modal-btn');

        if (!passphrase) {
            errEl.textContent = 'Enter your passphrase';
            errEl.style.display = 'block';
            return;
        }

        btn.disabled = true;
        btn.innerHTML = '<span class="spinner"></span> Unlockingâ€¦';

        try {
            await api(`/vault/unlock${_envQS()}`, { method: 'POST', body: JSON.stringify({ passphrase }) });
            closeVaultModal();
            toast('Vault unlocked â€” secrets decrypted', 'success');
            await loadSecretsTab();
        } catch (e) {
            errEl.textContent = e.message;
            errEl.style.display = 'block';
        } finally {
            btn.disabled = false;
            btn.textContent = 'ğŸ”“ Unlock';
        }
    }
